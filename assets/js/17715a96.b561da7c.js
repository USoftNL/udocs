"use strict";(self.webpackChunkudocs=self.webpackChunkudocs||[]).push([[2804],{28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(96540);const i={},s=r.createContext(i);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:t},e.children)}},74394:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Services/SQL_statements_in_USoft_services/Example_a_REST_service_for_retrieving_data_SELECT","title":"Example: a REST service for retrieving data (SELECT)","description":"The following step-by-step instructions are for creating a custom REST service that retrieves data on the basis of a booking ID.","source":"@site/docs/Services/SQL_statements_in_USoft_services/Example_a_REST_service_for_retrieving_data_SELECT.md","sourceDirName":"Services/SQL_statements_in_USoft_services","slug":"/Services/SQL_statements_in_USoft_services/Example_a_REST_service_for_retrieving_data_SELECT","permalink":"/udocs/Services/SQL_statements_in_USoft_services/Example_a_REST_service_for_retrieving_data_SELECT","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"Example_a_REST_service_for_retrieving_data_SELECT"},"sidebar":"sidebar","previous":{"title":"SQL statements in USoft services","permalink":"/udocs/Services/SQL_statements_in_USoft_services/"},"next":{"title":"Example: a REST Service for adding new data (INSERT)","permalink":"/udocs/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_adding_new_data_INSERT"}}');var i=n(74848),s=n(28453);const a={id:"Example_a_REST_service_for_retrieving_data_SELECT"},o="Example: a REST service for retrieving data (SELECT)",h={},c=[{value:"Defining SQL for data presentation",id:"defining-sql-for-data-presentation",level:2},{value:"Generating a REST method based on SQL",id:"generating-a-rest-method-based-on-sql",level:2},{value:"Publishing the solution",id:"publishing-the-solution",level:2},{value:"Testing the implementation",id:"testing-the-implementation",level:2},{value:"Retrieving multiple rows",id:"retrieving-multiple-rows",level:2}];function l(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"example-a-rest-service-for-retrieving-data-select",children:"Example: a REST service for retrieving data (SELECT)"})}),"\n",(0,i.jsx)(t.p,{children:"The following step-by-step instructions are for creating a custom REST service that retrieves data on the basis of a booking ID."}),"\n",(0,i.jsx)(t.p,{children:"This example shows how you can quickly generate a REST service from a SQL statement."}),"\n",(0,i.jsx)(t.p,{children:"In this particular example, matrix parameters are used, but you have a number of other options when designing input parameters."}),"\n",(0,i.jsx)(t.h2,{id:"defining-sql-for-data-presentation",children:"Defining SQL for data presentation"}),"\n",(0,i.jsx)(t.p,{children:"Often the data structure you want to present through a REST service is not exactly the same as the table structure (the data model) in which you store the data in the database. You want to re-structure the data for presentation through the REST service."}),"\n",(0,i.jsx)(t.p,{children:'The Service Definer lets you create SQL statements "on top of" the data model. These statements tailor the data structure to the requirements of your REST service.'}),"\n",(0,i.jsx)(t.p,{children:"An elegant way is to work with 2 layers. First create a Logical View in USoft Definer that formats the data in functional terms to the required structure. Then, in USoft Service Definer, write your REST service functionality against this Logical View. The functional Logical View becomes available for use everywhere in your application. Only the more technical service aspect is associated with the REST service itself."}),"\n",(0,i.jsx)(t.p,{children:"This 2-layer strategy is demonstrated in the following steps."}),"\n",(0,i.jsx)(t.p,{children:"1.\xa0In USoft Definer, create a Logical View that selects a specific subset of columns and records that you want to present through the REST service."}),"\n",(0,i.jsx)(t.p,{children:"For example, the following view statement presents certain properties of active bookings in a travel agency:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'SELECT   Reservation.res_id\n,        Reservation.schedtour_id\n,        "Scheduled tour".destination\n,        "Scheduled tour".tour_type\n,        "Scheduled tour".start_date\n,        "Scheduled tour".return_date\n,        Reservation.num_part\nFROM     Reservation Reservation\n,        Schedtour "Scheduled tour"\nRELATE   "Scheduled tour" "FOR WHICH ARE MADE" Reservation\nWHERE    "Scheduled tour".start_date > TRANSACTION_DATE()\nAND      Reservation.cancel_date IS NULL\n'})}),"\n",(0,i.jsx)(t.p,{children:"2.\xa0Have the Logical View checked (press the Check button), then save your work. See the Definer Help for details on this step."}),"\n",(0,i.jsx)(t.p,{children:"3.\xa0In USoft Service Definer, if you have an existing connection you want to use, then re-start the Rules Service of that connection so that it picks up the new Logical View definition. Otherwise, in USoft Service Definer, make sure you define a Rules Service, the Application, and a Connection, and make sure you start the Rules Service."}),"\n",(0,i.jsx)(t.p,{children:"4.\xa0In USoft Service Definer, choose Define, SQL Statements and add the following statement."}),"\n",(0,i.jsxs)(t.p,{children:["The WHERE clause in this statement will allow users of your REST service to identify the row they want to see. To define a REST service that will retrieve ",(0,i.jsx)(t.em,{children:"multiple"}),' rows, see the "Retrieving multiple rows" section at the end of this help topic.']}),"\n",(0,i.jsx)(t.p,{children:"Statement Name: GET_ACTIVE_BOOKING"}),"\n",(0,i.jsx)(t.p,{children:"Statement:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"SELECT   res_id\n,        schedtour_id\n,        destination\n,        tour_type\n,        start_date\n,        return_date\n,        num_part\nFROM     active_booking\nWHERE    res_id = :booking_id\n"})}),"\n",(0,i.jsx)(t.p,{children:"5.\xa0Save. Click the Check button. See that the Correct flag is set to Yes."}),"\n",(0,i.jsx)(t.h2,{id:"generating-a-rest-method-based-on-sql",children:"Generating a REST method based on SQL"}),"\n",(0,i.jsx)(t.p,{children:'1.\xa0Define a custom REST service and make sure that this new service is exposed by a Server. For details on how to do these 2 things, step out to help topic " Setting up your own REST service ".'}),"\n",(0,i.jsx)(t.p,{children:"2.\xa0On the Methods tab, create a record for the retrieval method:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Method Name = ",(0,i.jsx)(t.strong,{children:"GetActiveBooking"})]}),"\n",(0,i.jsxs)(t.li,{children:["Relative URI Path = ",(0,i.jsx)(t.strong,{children:"/ActiveBookings"})]}),"\n",(0,i.jsxs)(t.li,{children:["REST HTTP Verb = ",(0,i.jsx)(t.strong,{children:"GET"})]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:'3.\xa0Press the "Generate from SQL" button.The "Generate Method from SQL Statement" appears.'}),"\n",(0,i.jsxs)(t.p,{children:['4.\xa0In the "Return Structure Name" field, enter ',(0,i.jsx)(t.strong,{children:"MyBookingStructure"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"5.\xa0On the SQL Statements tab, click in the record for the SQL statement that you want the REST method to be generated from."}),"\n",(0,i.jsx)(t.p,{children:"The SQL code is now in view in the box on the right. Check that the Correct flag is set to Yes."}),"\n",(0,i.jsx)(t.p,{children:"6.\xa0Press the Generate button."}),"\n",(0,i.jsx)(t.p,{children:"In the REST Services window or tab, values for Signature, Implementation and Parameters are generated.In the Catalog on the left-hand side, a Structure with name MyBookingStructure is offered for inspection."}),"\n",(0,i.jsx)(t.h2,{id:"publishing-the-solution",children:"Publishing the solution"}),"\n",(0,i.jsx)(t.p,{children:"1.\xa0Choose Define, Servers, and retrieve the record of the Server where you expose the service."}),"\n",(0,i.jsx)(t.p,{children:"2.\xa0With input focus on this record, choose Publish, Publish and Restart from the menu."}),"\n",(0,i.jsx)(t.h2,{id:"testing-the-implementation",children:"Testing the implementation"}),"\n",(0,i.jsx)(t.p,{children:"1.\xa0Open a Google Chrome browser window, search the download site for the \u201cPOSTMAN \u2013 REST Client\u201d Google extension, and download it to your browser."}),"\n",(0,i.jsx)(t.p,{children:"Once installed, this extension can be opened easily from a new Google Chrome browser tab. To do this, click the standard \u201cApps\u201d button on the Favorites bar, then click the POSTMAN item in the middle of the screen."}),"\n",(0,i.jsx)(t.p,{children:"2.\xa0Open POSTMAN, and specify the following URL:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"http://host:port/service-uri/method-uri;variable=value[;variable=value...]\n"})}),"\n",(0,i.jsx)(t.p,{children:"for example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"http://localhost:8090/mycustomservice/ActiveBookings;booking_id=182\n"})}),"\n",(0,i.jsx)(t.p,{children:"Here, 'reservation_id' is a matrix parameter. See the help topic \" Input Parameters as Matrix Parameters \" for details."}),"\n",(0,i.jsx)(t.p,{children:"3.\xa0Check that your request is about to use the GET protocol (this is the default, displayed to the right of the URL)."}),"\n",(0,i.jsx)(t.p,{children:"4.\xa0Press the Send button."}),"\n",(0,i.jsx)(t.p,{children:"See that booking information is retrieved and displayed in the lower pane."}),"\n",(0,i.jsx)(t.h2,{id:"retrieving-multiple-rows",children:"Retrieving multiple rows"}),"\n",(0,i.jsxs)(t.p,{children:["If you want to have ",(0,i.jsx)(t.em,{children:"more than one row"})," returned, or in this example more than one active booking you need to:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Change your SQL so that it retrieves multiple rows."}),"\n",(0,i.jsx)(t.li,{children:"Instruct the code generator to generate for a multiple-row select."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Follow these steps:"}),"\n",(0,i.jsx)(t.p,{children:"1.\xa0Go back to the SQL statement and omit the WHERE clause that restricts the result to 1 row:"}),"\n",(0,i.jsx)(t.p,{children:"Statement Name: GET_ACTIVE_BOOKING"}),"\n",(0,i.jsx)(t.p,{children:"Original statement:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"SELECT   res_id\n,        schedtour_id\n,        destination\n,        tour_type\n,        start_date\n,        return_date\n,        num_part\nFROM     active_booking\nWHERE    res_id = :booking_id\n"})}),"\n",(0,i.jsx)(t.p,{children:"New statement:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"SELECT   res_id\n,        schedtour_id\n,        destination\n,        tour_type\n,        start_date\n,        return_date\n,        num_part\nFROM     active_booking\n\n"})}),"\n",(0,i.jsx)(t.p,{children:"2.\xa0Press the Check button. See that Correct = Yes. Commit work."}),"\n",(0,i.jsxs)(t.p,{children:["3.\xa0Go back to the ",(0,i.jsx)(t.strong,{children:"GetActiveBooking"}),' method of the REST service and press the "Generate from SQL" button again.']}),"\n",(0,i.jsx)(t.p,{children:'4.\xa0In the "Generate method..." dialog, click again in the SQL Statement you want to use. Set:'}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{}),(0,i.jsx)(t.th,{})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Return Structure Name"}),(0,i.jsx)(t.td,{children:"MyBookingStructure"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Generate for multiple rows (Select statement)"}),(0,i.jsx)(t.td,{children:"Yes"})]})]})]}),"\n",(0,i.jsxs)(t.ol,{start:"5",children:["\n",(0,i.jsx)(t.li,{children:"Press the Generate button. You can see that there are a few changes to the generated code. It now uses an array( indicated by square brackets [ ] ) of the structure in the sql output class, the java object notation and the return type parameter."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"6.\xa0Select the Server, press the Publish and Restart button for it, so that the changes are re-published."}),"\n",(0,i.jsxs)(t.ol,{start:"7",children:["\n",(0,i.jsx)(t.li,{children:"Test your work."}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);