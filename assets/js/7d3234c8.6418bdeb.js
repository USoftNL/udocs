"use strict";(self.webpackChunkudocs=self.webpackChunkudocs||[]).push([[16801],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var r=n(96540);const s={},a=r.createContext(s);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:t},e.children)}},50583:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_returning_manipulated_data","title":"Example: a REST Service for returning manipulated data","description":"In the previous example, you changed the name of a customer that already exists in the database and returned HTTP status code \\"200 OK\\" as the sole response.","source":"@site/docs/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_returning_manipulated_data.md","sourceDirName":"Services/SQL_statements_in_USoft_services","slug":"/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_returning_manipulated_data","permalink":"/udocs/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_returning_manipulated_data","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"Example_a_REST_Service_for_returning_manipulated_data"},"sidebar":"sidebar","previous":{"title":"Example: a REST Service for manipulating data (UPDATE)","permalink":"/udocs/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_manipulating_data_UPDATE"},"next":{"title":"Example: a REST Service for deleting data (DELETE)","permalink":"/udocs/Services/SQL_statements_in_USoft_services/Example_a_REST_Service_for_deleting_data_DELETE"}}');var s=n(74848),a=n(28453);const i={id:"Example_a_REST_Service_for_returning_manipulated_data"},o="Example: a REST Service for returning manipulated data",d={},c=[{value:"Creating the basic manipulation method",id:"creating-the-basic-manipulation-method",level:2},{value:"Generating code for returning the result data",id:"generating-code-for-returning-the-result-data",level:2},{value:"Combining the implementations for the UPDATE and SELECT step",id:"combining-the-implementations-for-the-update-and-select-step",level:2}];function l(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"example-a-rest-service-for-returning-manipulated-data",children:"Example: a REST Service for returning manipulated data"})}),"\n",(0,s.jsx)(t.p,{children:'In the previous example, you changed the name of a customer that already exists in the database and returned HTTP status code "200 OK" as the sole response.'}),"\n",(0,s.jsx)(t.p,{children:'In this example, you supply the result data as a response. For this purpose, you re-use the "MyPersonNameStructure" Structure from the previous example.'}),"\n",(0,s.jsx)(t.p,{children:"An input parameter is used here that is part of the request URL path. There are alternatives to this: see the help topic on designing input parameters."}),"\n",(0,s.jsx)(t.h2,{id:"creating-the-basic-manipulation-method",children:"Creating the basic manipulation method"}),"\n",(0,s.jsx)(t.p,{children:"First, create the basic manipulation method. Follow the steps in the previous help topic."}),"\n",(0,s.jsx)(t.h2,{id:"generating-code-for-returning-the-result-data",children:"Generating code for returning the result data"}),"\n",(0,s.jsx)(t.p,{children:"To generate code for the result data, first create a new method as if you were only interested in retrieving customer names on the basis of IDs."}),"\n",(0,s.jsx)(t.p,{children:"1.\xa0In USoft Services Definer, choose Define, SQL Statements from the menu, then create a new SQL Statement record :"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Statement name"}),(0,s.jsx)(t.td,{children:"GET_PERSON_NAMES"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Application name"}),(0,s.jsx)(t.td,{children:"TRAVEL"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"\xa0"}),"\n",(0,s.jsx)(t.p,{children:"Statement:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"SELECT    first_name   FirstName\n,         family_name  SurName\nFROM      person\nWHERE     person_id = :id\n"})}),"\n",(0,s.jsx)(t.p,{children:'You are re-using the "CustomerDetails" Structure that you already have. This is why you need SQL Aliases that match the Fields of this Structure.'}),"\n",(0,s.jsxs)(t.p,{children:["2.\xa0Open the REST Services window or tab, retrieve your REST service in it, click on a ",(0,s.jsx)(t.strong,{children:"new"}),' line in the Methods tab, then click the "Generate from SQL" button.']}),"\n",(0,s.jsx)(t.p,{children:'3.\xa0In the "Generate Method from Statement" dialog, fill out these fields:'}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Method Name"}),(0,s.jsx)(t.td,{children:"GetPersonNames"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Relative URI Path"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"/PersonNames/{id}"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"REST HTTP Verb"}),(0,s.jsx)(t.td,{children:"GET"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Produces"}),(0,s.jsx)(t.td,{children:"text/xml"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Return Structure Name"}),(0,s.jsx)(t.td,{children:"MyPersonNameStructure"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"\xa0"}),"\n",(0,s.jsx)(t.p,{children:"4.\xa0In the SQL Statements tab, select the GET_PERSON_NAMES statement, then click the Generate button."}),"\n",(0,s.jsx)(t.p,{children:'5.\xa0Back in the REST Services window or tab on the Parameter tab for the new method, set the Annotation of the "id" Parameter to'}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Annotation"}),(0,s.jsx)(t.td,{children:'@PathParam("id")'})]})})]}),"\n",(0,s.jsx)(t.p,{children:"\xa0"}),"\n",(0,s.jsx)(t.p,{children:"6.\xa0Publish and Restart the Server where you publish the REST service, and call the new method to check that the response message is what you want."}),"\n",(0,s.jsx)(t.h2,{id:"combining-the-implementations-for-the-update-and-select-step",children:"Combining the implementations for the UPDATE and SELECT step"}),"\n",(0,s.jsxs)(t.p,{children:["1.\xa0Find the Implementation of the ",(0,s.jsx)(t.strong,{children:"GetPersonNames"})," method. Depending on your patch version this could be something like:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-language-java",children:'MyPersonNameStructure result = (MyPersonNameStructure)sql( MyPersonNameStructure.class, "GET_PERSON_NAMES" , new Object[]{ id } );\n\n/* delete following 2 lines if you want HTT 204 success code in case of an empty recordset */\nif(result==null)\n   throw new javax.ws.rs.WebApplicationException(404);\n\nreturn result;\n'})}),"\n",(0,s.jsx)(t.p,{children:"2.\xa0Copy this code (this entire text) to the clipboard."}),"\n",(0,s.jsxs)(t.p,{children:["3.\xa0Go to the Implementation of the ",(0,s.jsx)(t.strong,{children:"PutPersonNames"})," method and append the copied text to this code. Depending on your patch version of USoft, the result of this paste action could be something like:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-language-java",children:'Integer count = (Integer) sql(Integer.class, "SET_PERSON_NAMES", new Object[]{ objMyPersonNameStructure, id } );\n\n/* return http error 404 if no records updated */   \nif(count.intValue() == 0)\n   throw new javax.ws.rs.WebApplicationException(404);\n\nMyPersonNameStructure result = (MyPersonNameStructure)sql( MyPersonNameStructure.class, "GET_PERSON_NAMES" , new Object[]{ id } );\n\n/* delete following 2 lines if you want HTT 204 success code in case of an empty recordset */\nif(result==null)\n   throw new javax.ws.rs.WebApplicationException(404);\n\nreturn result;\n'})}),"\n",(0,s.jsx)(t.p,{children:"4.\xa0Notice that you now have 2 different code snippets dealing with the eventuality that no records were updated. Shorten the code by choosing just one, and erasing the other, so that the end result becomes something like:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-language-java",children:'Integer count = (Integer) sql(Integer.class, "SET_PERSON_NAMES", new Object[]{ objMyPersonNameStructure, id } );\n\nMyPersonNameStructure result = (MyPersonNameStructure)sql( MyPersonNameStructure.class, "GET_PERSON_NAMES" , new Object[]{ id } );\n\n/* delete following 2 lines if you want HTT 204 success code in case of an empty recordset */\nif(result==null)\n   throw new javax.ws.rs.WebApplicationException(404);\n\nreturn result;\n'})}),"\n",(0,s.jsxs)(t.p,{children:["5.\xa0For the ",(0,s.jsx)(t.strong,{children:"PutPersonNames"})," method, manually add a return parameter in the Parameters tab with the following settings:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Name"}),(0,s.jsx)(t.td,{children:"Result"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Type"}),(0,s.jsx)(t.td,{children:"MyPersonNameStructure"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Return Parameter"}),(0,s.jsx)(t.td,{children:"Yes"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"6.\xa0Publish and Restart the server where you are publishing your REST service. Test that the REST call of the previous help topic:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"http://localhost:8090/mycustomservice/PersonNames/17\n"})}),"\n",(0,s.jsx)(t.p,{children:'now returns not just the "200 OK" HTTP status code, but also the result data of the manipulation.'})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);