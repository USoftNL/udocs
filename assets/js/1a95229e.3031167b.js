"use strict";(self.webpackChunkudocs=self.webpackChunkudocs||[]).push([[53025],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>d});var r=n(96540);const s={},a=r.createContext(s);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:t},e.children)}},31548:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Web_and_app_UIs/USoft_template_defaults/usoftzero_wizard","title":"usoft-zero wizard","description":"The usoft-zero web default comes with a wizard. This wizard can be used to add data in steps. This may be necessary if you want to add data for a parent table and a child table in a single transaction.","source":"@site/docs/Web_and_app_UIs/USoft_template_defaults/usoftzero_wizard.md","sourceDirName":"Web_and_app_UIs/USoft_template_defaults","slug":"/Web_and_app_UIs/USoft_template_defaults/usoftzero_wizard","permalink":"/udocs/Web_and_app_UIs/USoft_template_defaults/usoftzero_wizard","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"usoftzero_wizard"},"sidebar":"sidebar","previous":{"title":"usoft-zero dialogs","permalink":"/udocs/Web_and_app_UIs/USoft_template_defaults/usoftzero_dialogs"},"next":{"title":"usoft-zero dynamic defaults","permalink":"/udocs/Web_and_app_UIs/USoft_template_defaults/usoftzero_dynamic_defaults"}}');var s=n(74848),a=n(28453);const i={id:"usoftzero_wizard"},d="usoft-zero wizard",o={},l=[{value:"Header",id:"header",level:3},{value:"Subtitle",id:"subtitle",level:3},{value:"Step indicator",id:"step-indicator",level:3},{value:"Body and steps",id:"body-and-steps",level:3},{value:"Footer",id:"footer",level:3},{value:"Events/triggers",id:"eventstriggers",level:3},{value:"Example: Insert sales order with orderlines",id:"example-insert-sales-order-with-orderlines",level:2},{value:"DetailPage ORDER \u2013 create with wizard",id:"detailpage-order--create-with-wizard",level:3},{value:"Wizard",id:"wizard",level:3},{value:"Data sources",id:"data-sources",level:3},{value:"Open wizard",id:"open-wizard",level:3},{value:"Close window",id:"close-window",level:3},{value:"Page triggers",id:"page-triggers",level:3},{value:"Wizard triggers and buttons",id:"wizard-triggers-and-buttons",level:3},{value:"Shortcomings",id:"shortcomings",level:3}];function h(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"usoft-zero-wizard",children:"usoft-zero wizard"})}),"\n",(0,s.jsx)(t.p,{children:"The usoft-zero web default comes with a wizard. This wizard can be used to add data in steps. This may be necessary if you want to add data for a parent table and a child table in a single transaction."}),"\n",(0,s.jsx)(t.p,{children:"Think of orders with order lines, where each order must have at least 1 order line. This can be handled by a wizard performing 2 steps. The first step inserts the order record. The second step inserts the order line record. The user can optionally add more order lines. See the Example in the bottom half of this article."}),"\n",(0,s.jsx)(t.p,{children:"A wizard has a header, subtitle, step indicator, body with steps, and footer with buttons."}),"\n",(0,s.jsx)(t.h3,{id:"header",children:"Header"}),"\n",(0,s.jsx)(t.p,{children:"The header contains a New label, an Edit label, and a custom label that the developer is to specify. The New and the Edit label will automatically be shown or hidden, depending on the for-edit class or the for-new class on the wizard. The custom label could be the object name of the parent table, in our example \u2018order' or 'sales order\u2019."}),"\n",(0,s.jsx)(t.h3,{id:"subtitle",children:"Subtitle"}),"\n",(0,s.jsx)(t.p,{children:"A wizard should contain a subtitle label for every step. The wizard will take care of showing the correct label when stepping through the wizard on condition that the labels are specified in the correct order, which is the order of the steps. For example:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{}),"\n",(0,s.jsx)(t.li,{}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"step-indicator",children:"Step indicator"}),"\n",(0,s.jsx)(t.p,{children:"The step indicator visualises the total number of steps of the wizard and the step that the user is currently at."}),"\n",(0,s.jsx)(t.p,{children:"No developer action is required. The step indicator is delivered as a working default."}),"\n",(0,s.jsx)(t.h3,{id:"body-and-steps",children:"Body and steps"}),"\n",(0,s.jsx)(t.p,{children:"A wizard comes with 2 default (empty) steps. The developer can add more steps. The contents of the steps must be created by the developer."}),"\n",(0,s.jsx)(t.p,{children:"The easiest way to create content for a wizard step is to copy the contents from the body of the offcanvas edit pane of an infoPage into a wizard step. Make sure that:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"There is a correct data source in your page."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The data sources for any dropdowns are present."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"footer",children:"Footer"}),"\n",(0,s.jsx)(t.p,{children:"The footer contains Previous and Next buttons and a \u2018save\u2019 button. The wizard takes care of showing and hiding these buttons. The Previous and Next buttons use the corresponding events on the wizard to perform actions."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u2018saveeandnew\u2019 button"})}),"\n",(0,s.jsx)(t.p,{children:"The developer can add a \u2018Save and New\u2019 button. The \u2018saveandnew\u2019 button can be found under the buttons in the controls panel. The 'saveandnew\u2019 button is best placed immediately next to the Save button. If you insert it, It will be automatically positioned correctly and in the application, it will show up during the last wizard step."}),"\n",(0,s.jsx)(t.p,{children:"The developer should include a \u2018settings\u2019 and a \u2018saveandnew' event in the page. The \u2018settings' event is best copied from an infoPage and then adjusted. The 'saveandnew\u2019 event can be found in the catalog. If needed, the developer can adjust the 'saveandnew\u2019 trigger."}),"\n",(0,s.jsx)(t.h3,{id:"eventstriggers",children:"Events/triggers"}),"\n",(0,s.jsx)(t.p,{children:"The wizard comes with the following events or triggers:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Event/trigger"})}),(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Description"})})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"onload"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)("p",{children:"Creates the step indicators."}),(0,s.jsx)("p",{children:"Of no concern to the developer."})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"next"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)("p",{children:"If there are no errors, proceed to the next step."}),(0,s.jsx)("p",{children:"It is very probable that the developer needs to add extra logic, for example to create records or to perform a CheckData action in order to get a server-generated primary key value. See the example below."})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"previous"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)("p",{children:"Goes back to the previous step (unconditionally)."}),(0,s.jsx)("p",{children:"Of no concern to the Developer."})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"hidden.bs.offcanvas.rollback"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)("p",{children:"When closing the wizard, this:"}),(0,s.jsxs)("p",{children:["- ",(0,s.jsx)("p",{children:"re-initialises the validator."}),(0,s.jsx)("br",{}),"- ",(0,s.jsx)("p",{children:"performs a rollback."}),(0,s.jsx)("br",{}),"- ",(0,s.jsx)("p",{children:"calls the page's refreshdatasource event if data was committed."}),(0,s.jsx)("br",{}),"- ",(0,s.jsx)("p",{children:"calls the page\u2019s showhideelements event."}),(0,s.jsx)("br",{})]}),(0,s.jsx)("p",{children:"Normally this trigger requires no change, but you may want to add enhancements. See the example below."})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"setstepindicator"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)("p",{children:"Update the presentation of the step indicator."}),(0,s.jsx)("p",{children:"Of no concern to the developer."})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"showhide"}),(0,s.jsxs)(t.td,{children:[(0,s.jsxs)("p",{children:["- ",(0,s.jsx)("p",{children:"Shows the correct subtitle."}),(0,s.jsx)("br",{}),"- ",(0,s.jsx)("p",{children:"Shows the correct buttons."}),(0,s.jsx)("br",{})]}),(0,s.jsx)("p",{children:"Of no concern to the developer."})]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"example-insert-sales-order-with-orderlines",children:"Example: Insert sales order with orderlines"}),"\n",(0,s.jsx)(t.p,{children:"In this example, a wizard combines the INSERT of an order record (Step 1) and the INSERT of the first orderline record for that order (Step 2)."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Design"})}),"\n",(0,s.jsx)(t.p,{children:"At the end of the wizard, the user has the option to add more orderlines."}),"\n",(0,s.jsx)(t.p,{children:"A page is created with the same functionality as a DetailPage but with the addition of a wizard. When the page opens, it opens with the wizard taking the user through the steps of inserting an order and then inserting order lines."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"If the wizard closes after some data is entered and saved, the user remains in the page and the page will behave like a normal DetailPage."}),"\n",(0,s.jsx)(t.li,{children:"If the wizard closes before data is saved, the page will be closed."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"detailpage-order--create-with-wizard",children:"DetailPage ORDER \u2013 create with wizard"}),"\n",(0,s.jsx)(t.p,{children:"In the catalog, create a subclass of \u201cDetailPage ORDER\u201d named: \u201cDetailPage ORDER \u2013 create with wizard\u201d."}),"\n",(0,s.jsx)(t.p,{children:"Make sure the user can reach this page. Typically, add a button for this purpose in \u201cInfoPage ORDER\u201d. The developer is required to do this manually."}),"\n",(0,s.jsx)(t.h3,{id:"wizard",children:"Wizard"}),"\n",(0,s.jsx)(t.p,{children:"On \u201cDetailPage ORDER \u2013 create with wizard\u201d, drag a wizard control from the Controls tab of the catalog. Find this under HTMLElementControl/DIV."}),"\n",(0,s.jsx)(t.p,{children:"We want a wizard with 2 steps. Step 1 for entering the order and Step 2 for entering order lines."}),"\n",(0,s.jsx)(t.p,{children:"For Step 1:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'Copy the fields for order entry from the offcanvasRightEditBody object in "InfoPage ORDER\u201d.'}),"\n",(0,s.jsx)(t.li,{children:"Paste te content under Wizard/wizard-body/wizard-body/step-1."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"For Step 2:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'Copy the fields for order entry from the offcanvasRightEditBody object in "InfoPage ORDERLINE\u201d.'}),"\n",(0,s.jsx)(t.li,{children:"Paste te content under Wizard/wizard-body/wizard-body/step-2."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"data-sources",children:"Data sources"}),"\n",(0,s.jsx)(t.p,{children:"On \u201cDetailPage ORDER \u2013 create with wizard\u201d, create data sources ORDER and ORDERLINE, where ORDERLINE is a related data source."}),"\n",(0,s.jsx)(t.p,{children:"Change the ORDER data source to relate to the ORDER data source in the calling page."}),"\n",(0,s.jsx)(t.h3,{id:"open-wizard",children:"Open wizard"}),"\n",(0,s.jsx)(t.p,{children:"When the page opens, we want the wizard to open and a new record line to be created for the order."}),"\n",(0,s.jsxs)(t.p,{children:["On the wizard, add an ",(0,s.jsx)(t.strong,{children:"onloadopenwizard"})," (type: onload) event that:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Creates a new ORDER row (See code under the New button) and then"}),"\n",(0,s.jsx)(t.li,{children:"Opens the wizard."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"bootstrap.Offcanvas.getOrCreateInstance($('#wizard')[0]).show();\n"})}),"\n",(0,s.jsx)(t.h3,{id:"close-window",children:"Close window"}),"\n",(0,s.jsx)(t.p,{children:"If the wizard is canceled and no data was added, we want to close the page and return to the calling InfoPage."}),"\n",(0,s.jsx)(t.p,{children:"On the wizard, add a step to the hidden.bs.offcanvas trigger:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"result\n\t.then(() => {\n\t\t\tif (!$.udb('SALES_ORDER').rowCount()) {\n\t\t\t\treturn $.udb.closePage();\n\t\t\t}\n\t\t})\n"})}),"\n",(0,s.jsx)(t.p,{children:"Notice that \u2018result\u2019 is a Promise. The promise is set in the first step of the trigger."}),"\n",(0,s.jsx)(t.h3,{id:"page-triggers",children:"Page triggers"}),"\n",(0,s.jsx)(t.p,{children:"Add the following triggers on the page."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"onloadopenwizard (type: onload)"})}),"\n",(0,s.jsx)(t.p,{children:"See above."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"onloadshowhideelements (type: onload)"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"$(this).find('.DetailCard, .RelatedCard').trigger('showhideelements');\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"pageshow"})}),"\n",(0,s.jsx)(t.p,{children:"Inherited from the superclass. No need to change it."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"refreshdata"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"options.result = $.udb('DetailCard SALES_ORDER/SALES_ORDER').executeQuery()\n\t.then(() => $.udb('RelatedCard ORDER_LINE of SALES_ORDER/ORDER_LINE').executeQuery())\n;\n"})}),"\n",(0,s.jsx)(t.p,{children:"The difficulty here is that the trigger is called from the \u2018saveandnew' and that the 'saveandnew\u2019 will perform a create record. You must be sure that the refreshdata is finished before the create record will be performed, otherwise the new (empty) record will be checked because of the queries being fired."}),"\n",(0,s.jsx)(t.p,{children:"Another issue is that on the ORDER datasource the refresh will not work since no data has been queried in first instance. An executeQuery() must be used."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"saveandnew"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"let $page = $(this);\nlet settings = getSettings($page);\nlet $offcanvas = $(settings.offcanvas);\nlet fields = $offcanvas.find('.EditField:visible').find('input, select, textarea');\n\nevent.stopPropagation();\n\n// Check all fields and get messages if necessary\nfields.each((i, elem) => $(elem).valid() || true); \n\nif (fields.valid()) {\n\t$.udb.wait(true)\n\t$.udb.commit({quiet: true})\n\t\t.then(() => $page.data('committed', true))\n\t\t.then(() => {\n\t\t\tlet result = {result: Promise.resolve(true)};\n\n\t\t\t$page.trigger('refreshdata', [result]);\n\n\t\t\treturn result.result;\n\t\t})\n\t\t.then(() => $.udb(settings.ds_table).rowCreate(settings.rowCreateOptions))\n\t\t.then(() => $offcanvas.trigger('enabledisablebuttons'))\n\t\t.finally(() => $.udb.wait(false))\n\t;\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"This is the standard \u2018saveandnew' with, additionally, the call to the 'refreshdata\u2019 trigger. The trigger must be called and finished before the record is created. Otherwise, checks will be performed on the newly created empty record."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"settings"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"event.stopPropagation();\n\noptions.settings.ds_table = 'ORDER_LINE';\noptions.settings.offcanvas = '#wizard';\noptions.settings.rowCreateOptions = {};\n"})}),"\n",(0,s.jsx)(t.p,{children:"This must contain the settings for the ORDERLINE as the settings will be called from the \u2018saveandnew' and the 'saveandnew\u2019 will only show on the last wizard step, which is the wizard step for ORDERLINE."}),"\n",(0,s.jsx)(t.h3,{id:"wizard-triggers-and-buttons",children:"Wizard triggers and buttons"}),"\n",(0,s.jsx)(t.p,{children:"On the wizard, the following triggers and buttons must be added or edited."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"next trigger"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"let $wizard = $(this);\nlet $page = $wizard.closest('.Page');\nlet fields = $wizard.find('.EditField:visible').find('input, select, textarea');\nlet rowCreateOptions = {};\n\nasync function checkDataOnFirstStep(stepno) {\n\tif (stepno === 0) {\n\t\tlet hasValue = !!$.udb('SALES_ORDER').rows('current').cols('ID').val();\n\n\t\tif (!hasValue)\n\t\t\tawait $.udb.checkData({quiet: true});\n\t}\n}\n\nasync function createRowOrderLine(stepno) {\n\tif (stepno === 0 && !$.udb('ORDER_LINE').rowCount()) {\n\t\tawait $.udb('ORDER_LINE').rowCreate(rowCreateOptions);\n\t}\n}\n\nasync function beforeNext(stepno) {\n\tawait checkDataOnFirstStep(stepno);\n\tawait createRowOrderLine(stepno);\n}\n\n// Check all fields and get messages if necessary\nfields.each((i, elem) => $(elem).valid() || true); \n\nif (fields.valid()) {\n\tbeforeNext(wizardStep($wizard))\n\t\t.then(() => {\n\t\t\t$wizard\n\t\t\t\t.find('.wizard-body-step:not(.hide)')\n\t\t\t\t.addClass('hide')\n\t\t\t\t.next('.wizard-body-step')\n\t\t\t\t.removeClass('hide');\n\t\t\t;\n\n\t\t\t$wizard\n\t\t\t\t.trigger('setstepindicator')\n\t\t\t\t.trigger('showhide')\n\t\t\t\t.trigger('focus-first-field')\n\t\t\t;\n\t\t})\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Save and new button"})}),"\n",(0,s.jsx)(t.p,{children:"Add the 'Save and new' button to the wizard."}),"\n",(0,s.jsx)(t.p,{children:"Take the button from the Controls tab of the catalog: ButtonControl/SalesAndNewButtonControl"}),"\n",(0,s.jsx)(t.p,{children:"Add this button to the wizard in: wizard/wizard/footer/wizard-footer-right-buttons. If you drop it there, it will position itself correctly"}),"\n",(0,s.jsx)(t.h3,{id:"shortcomings",children:"Shortcomings"}),"\n",(0,s.jsx)(t.p,{children:"When you navigate from step 1 to step 2, you have entered data for ORDER. A CheckData() is performed and, after that, a \u2018refreshdata' is triggered. But the 'refreshdata\u2019 does not work. So data is only refreshed in the page after data has been saved."})]})}function c(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);