"use strict";(self.webpackChunkudocs=self.webpackChunkudocs||[]).push([[5013],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},71320:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Extensions/DotNet_components/C_component_Example_4_Cookie_enabled_HTTP_client","title":"C# component Example 4: Cookie enabled HTTP client","description":"component Example 4: Cookie enabled HTTP client","source":"@site/docs/Extensions/DotNet_components/C_component_Example_4_Cookie_enabled_HTTP_client.md","sourceDirName":"Extensions/DotNet_components","slug":"/Extensions/DotNet_components/C_component_Example_4_Cookie_enabled_HTTP_client","permalink":"/udocs/Extensions/DotNet_components/C_component_Example_4_Cookie_enabled_HTTP_client","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"C_component_Example_4_Cookie_enabled_HTTP_client"},"sidebar":"sidebar","previous":{"title":"C# component Example 3: External DLL","permalink":"/udocs/Extensions/DotNet_components/C_component_Example_3_External_DLL"},"next":{"title":"JavaScript components","permalink":"/udocs/Extensions/DotNet_components/JavaScript_components"}}');var i=t(74848),o=t(28453);const r={id:"C_component_Example_4_Cookie_enabled_HTTP_client"},a="C# component Example 4: Cookie enabled HTTP client",l={},c=[{value:"REST Service description",id:"rest-service-description",level:2},{value:"Defining C# Component",id:"defining-c-component",level:2},{value:"Code Explained",id:"code-explained",level:2},{value:"Example usage:",id:"example-usage",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"c-component-example-4-cookie-enabled-http-client",children:"C# component Example 4: Cookie enabled HTTP client"})}),"\n",(0,i.jsxs)(n.p,{children:["This example shows how you define a cookie enabled HTTP web client component that allows you to manage cookies throughout the client session and perform cookie based authentication. The C# component uses ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.net.cookiecontainer?view=net-7.0",children:"CookieContainers"})," in order to enable usage of cookies."]}),"\n",(0,i.jsx)(n.h2,{id:"rest-service-description",children:"REST Service description"}),"\n",(0,i.jsx)(n.p,{children:"This example assumes you are calling a USoft REST service to query a table \u201cRESERVATIONS\u201d, using an endpoint:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"localhost:8112/API/TRAVEL_CONN_API/reservations"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The server uses\xa0HTTP Basic authentication. The endpoint allows GET and POST requests. Visit the ",(0,i.jsx)(n.a,{href:"/udocs/Services/Introducing_USoft_Services/Getting_started_with_USoft_services_Quick_WalkThrough",children:"following"})," article to get started with creating your own USoft REST Service."]}),"\n",(0,i.jsx)(n.h2,{id:"defining-c-component",children:"Defining C# Component"}),"\n",(0,i.jsx)(n.p,{children:"To add the component:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{}),"\n",(0,i.jsx)(n.li,{}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-language-csharp",children:'using System;\nusing System.Xml;\nusing USoft.Web;\nusing System.Collections.Generic;\n\nclass MYAPI: UHttpRequest\n{\n\xa0\xa0 \xa0//(string baseurl, int timeout, string[] header) : base(baseurl, timeout, header\n\xa0\xa0\xa0\xa0public MYAPI() : base("", 100, new String[]{}){}\n\n\xa0\xa0 \xa0public static List<string> BuildHeader(string[] headersArray)\n\xa0\xa0 \xa0{\n\xa0\xa0 \xa0\xa0\xa0 \xa0List<string> headers = new List<string>();\n\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if(headersArray!=null){\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0for (int i = 0; i < headersArray.Length; i += 2)\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0{\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0headers.Add(headersArray[i]);\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0headers.Add(headersArray[i + 1]);\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0}\n\xa0\xa0 \xa0\xa0\xa0 \xa0}\n\xa0\xa0 \xa0\xa0\xa0 \xa0return headers;\n\xa0\xa0 \xa0}\n\n\xa0\xa0 \xa0public static void testAuthorizationHeader(string user, string pwd, List<string> header){\n\xa0\xa0 \xa0\xa0\xa0 \xa0// utility function to prepare basic auth header value\n\xa0\xa0 \xa0\xa0\xa0 \xa0string BA = basicAuth(user, pwd);\n\xa0\xa0 \xa0\xa0\xa0 \xa0//leaving user empty wont add authorization headers to test if cookies work.\n\xa0\xa0 \xa0\xa0\xa0 \xa0if(!string.IsNullOrEmpty(user)){\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0header.Add("Authorization");\n\xa0\xa0 \xa0\xa0\xa0 \xa0\xa0\xa0 \xa0header.Add(BA);\n\xa0\xa0 \xa0\xa0\xa0 \xa0}\n\xa0\xa0 \xa0}\n\n\xa0\xa0 \xa0public string getReservations(string user, string pwd, string[] headerData = null){\n\n\xa0\xa0 \xa0\xa0\xa0 \xa0List<string> headerList = BuildHeader(headerData);\n\n\xa0\xa0 \xa0\xa0\xa0 \xa0testAuthorizationHeader(user,pwd,headerList);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0return Visit("GET", "http://localhost:8112/API/TRAVEL_CONN_API/reservations", null, headerList.ToArray());;\n\n\xa0\xa0 \xa0}\n\n\xa0\xa0\xa0\xa0public string makeReservation(string xml, string user, string pwd, \xa0string[] headerData = null)\xa0\n\xa0\xa0\xa0\xa0{\n\n\xa0\xa0 \xa0\xa0\xa0 \xa0List<string> headerList = BuildHeader(headerData);\n\n\xa0\xa0 \xa0\xa0\xa0 \xa0testAuthorizationHeader(user,pwd,headerList);\n\xa0\xa0 \xa0\xa0\xa0 \xa0\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0return Visit("Post", "http://localhost:8112/API/TRAVEL_CONN_API/reservations", xml, headerList.ToArray());\n\xa0\xa0\xa0\xa0}\n\n\xa0\xa0 \xa0public XmlDocument myCookies(string url){\n\xa0\xa0 \xa0\xa0\xa0 \xa0return GetCookies(url);\n\xa0\xa0 \xa0}\n\n\xa0\xa0 \xa0public void myNewCookie(){\n\xa0\xa0 \xa0\xa0\xa0 \xa0//AddCookie(string name, string value, string path, string domain, double expiresAfterSeconds, bool httponly, bool secure, string comment)\n\xa0\xa0 \xa0\xa0\xa0 \xa0AddCookie("test", "1" , "", \xa0"usoft.com", 100, \xa0false, false, "myFirstcookie");\n\xa0\xa0 \xa0}\n\n}\n\n\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Stateful component = Y;"}),"\n",(0,i.jsx)(n.li,{children:"Lifetime = Engine Session;"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{}),"\n",(0,i.jsx)(n.li,{}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsx)(n.h2,{id:"code-explained",children:"Code Explained"}),"\n",(0,i.jsx)(n.p,{children:"The MYAPI class is a derived class that inherits from a UHttpRequest base class, which is part of the USoft.web namespace used internally by UBlend. UHttpRequest exposes some methods that we use to make Http requests, like Visit , GetCookies and AddCookie and more."}),"\n",(0,i.jsx)(n.p,{children:"The component provides a method getReservations() to get the reservations, but also a makeReservations() method that creates new reservations via an HTTP POST request. Both methods allow you to pass on HTTP request headers as final argument.\xa0The helper method BuildHeader() builds HTTP request headers to send along with the HTTP Request."}),"\n",(0,i.jsx)(n.p,{children:"Another method testAuthorizationHeader()\xa0is added to demonstrate that\xa0the cookie handling works in this example. It checks if a username and password is provided and if so, it will add an Authorization HTTP request Header to the HTTP call to perform Basic authentication. If not, the HTTP request is done without any authorization set, hence relying on cookie authentication."}),"\n",(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example usage:"}),"\n",(0,i.jsx)(n.p,{children:"To make an HTTP request via a USoft application:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open the C/S Application."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open SQL Command"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Execute the following statement to first check if cookies are stored for the connection:"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["select MYAPI.myCookies(\u2018",(0,i.jsx)(n.a,{href:"http://localhost:8112/API/TRAVEL_CONN_API/reservations",children:"http://localhost:8112/API/TRAVEL_CONN_API/reservations"}),"\u2019);"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This will return empty XML content:\n\xa0"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<cookies />"})}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"then perform a HTTP GET Request :"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"select MYAPI.getReservations('YOURUSERNAME','YOURPASSWORD');"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Will return all reservations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Reservations><RES_ID>255</RES_ID><TOUR_ID>6</TOUR_ID><MADE_BY>1</MADE_BY><DEALT_WITH_BY>37</DEALT_WITH_BY><PERSON_DISCOUNT>2</PERSON_DISCOUNT><GROUP_DISCOUNT>0</GROUP_DISCOUNT><PRICE>2254</PRICE><BOOK_DATE>2021-10-29T14:06:12+02:00</BOOK_DATE></Reservations>\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"If we again run the myCookies statement, it will now return cookie data:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<cookies><cookie name="TRAVEL_CONN" path="/" port="" expires="14-4-2023 16:04:27" expired="False" httponly="True" secure="False" domain="localhost" comment=""session id"" discard="False" timestamp="04/14/2023 15:54:27" version="1">70eedb4</cookie></cookies>\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Again call getReservations, but this time omit the username and password. It will use the cookie returned by the server in the previous call to perform Cookie based authentication:\n\xa0"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"select MYAPI.getReservations(null,null);"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Will return the same data as earlier."}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"Similarly for the POST Request, you can add headers to the request by passing along a string parameters in SQL command:\n\xa0"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'select MYAPI.makeReservation(\n\n\'<Reservations documentName="Reservations">\n\n<RESERVATION RES_ID="261" TOUR_ID="4" MADE_BY="10" DEALT_WITH_BY="43" PERSON_DISCOUNT=".0" GROUP_DISCOUNT=".0" PRICE="2254.0" BOOK_DATE="2021-10-29T14:06:12" CANCEL_DATE="2022-10-30T12:00:00"/>\n\n</Reservations>\'\n\n, \'TRAVEL_DEMO\',\'TRAVEL_DEMO\',\xa0 \'Accept\',\'text/xml\',\'Content-type\',\'text/xml\')\n'})}),"\n",(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsx)(n.li,{children:"Finally note that you can add your own cookie to send along with the HTTP request. Run the component myNewCookie() method or the UHttpRequest its AddCookie()\xa0method directly to do so:\n\xa0"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"select MYAPI.myNewCookie();"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"select MYAPI.AddCookie('test', '1' , '' ,'usoft.com', 100,'false','false', 'myFirstcookie');"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"When fetching cookies this time:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["select MYAPI.myCookies('",(0,i.jsx)(n.a,{href:"http://localhost:8112/API/TRAVEL_CONN_API/reservations",children:"http://localhost:8112/API/TRAVEL_CONN_API/reservations"}),"');"]}),"\n",(0,i.jsx)(n.li,{children:"It results in the earlier added cookie being returned:"}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)("cookies",{children:(0,i.jsx)("cookie",{name:"test",path:"",port:"",expires:"14-4-2023 16:17:12",expired:"False",httponly:"False",secure:"False",domain:"usoft.com",comment:"myFirstcookie",discard:"False",timestamp:"04/14/2023 16:15:32",version:"0",children:"1"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);